---
title: DNS 介绍
date: 2023-08-27 16:17:53
tags:
- DNS
categories:
- 计算机网络
---

<meta name="referrer" content="no-referrer" />
# DNS 介绍

DNS（Domain Name System），一个将域名转换为IP地址的系统。
DNS 协议是应用层协议，因为 TCP 建立连接必须需要 IP 地址，所以应用层必须要把域名解析成 IP 地址，才能建立 TCP 连接，否则会建立连接失败。

### 域名
域名本质是一个名字，使得用户能更方便地找到和访问网站，而不需要记住复杂的IP地址，如果每个网站都要你输入IP地址你岂不是要崩溃。

完全限定域名的组成部分，常见域名组成形式: 子域名(主机名)+二级(权威)域名+顶级域名。比如www.sina.com。
- com 为顶级域名，顶级域名是域名的最后一部分，它表示域名的类别或地理位置。常见的顶级域名有".com"、".net"、".org"、".edu"等，还有表示国家或地区的顶级域名，如".cn"、".uk"、".us"等。
- sina 为二级域名，一般为公司或者个人独特名字。
- www 为主机名(子域名)，用于主机的用途或者是网站的某个部分，比如 "www" 表示表示提供网页浏览服务的服务器，"ftp"用于文件传输服务，"mail"用于电子邮件服务。
  也可以用于公司标识不同网站不同部分一个公司可能会有“blog.example.com”来托管他们的博客，“shop.example.com”来托管他们的在线商店，或者“mail.example.com”来提供电子邮件服务。

域名可以用来在 tomcat 等 web 容器中标识虚拟主机，域名又被作为虚拟主机名，一个服务器下有多个虚拟机主机对外提供服务，把域名作为虚拟机主机名后，通过域名匹配找到对应的虚拟机主机。

## DNS服务器
**DNS 服务器即域名解析服务器，用于把域名解析成IP地址。** 比如在浏览器上面输入`www.taobao.com`，然后回车一下，浏览器就会跳转到淘宝的页面。

众所周知，发送网络请求时需要知道对方的IP地址，网络请求才会被发送出去。那为什么我们仅仅输入了域名就可以进入淘宝页面呢？
因为 DNS 服务器已经把`www.taobao.com`这个域名解析成了例如`192.168.0.10`这样的 IP 地址。

可以这么联想小明的家在北京市朝阳区新城国际23幢1单元505室。比如老师想去小明家做家访，老师这时候就用电脑调用出学生地址登记簿，就知道小明家的具体位置了。
这里小明的家就是域名，北京市朝阳区新城国际23幢1单元505室就是IP地址，老师查询的地址登记簿就是 DNS 服务器。

### DNS服务器结构

所有的域名都要DNS服务器来解析，那么DNS服务器就是分布式的，整体为树状结构，不一定就3层，根据系统可以继续向下分层级。
根DNS服务器全球一共 13 台。
上层 DNS 服务器返回下层 DNS 服务器的 IP 地址。

![DNS结构图(来源极客时间)](https://upload-images.jianshu.io/upload_images/4538003-7c8c1809298d359c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


## DNS 解析过程

比如解析 `www.google.com` 这个域名
1. 主机首先会查询操作系统 DNS 缓存，如果存在则返回，如果找不到再查询本地host文件，windows 下 host 文件在`C:\Windows\System32\drivers\etc`目录，linux系统在`\etc\host`下。

2. 如果 host 文件存在域名(主机名)和 IP 地址的映射关系，则直接返回，如果不存在在请求本地 DNS 服务器。

3. 主机会配置一个本地 DNS 服务器，windows 可以通过`ipconfig \all`指令查看。主机通过DNS协议把域名发给本地DNS服务器解析。本地DNS服务器会先查询DNS缓存，如果没有缓存则请求根DNS服务器。

4. 本地服务器中保存了 13 个根DNS服务器的地址，这些地址是固定不变的。本地服务器会向其中一个发起请求。根服务器管理`com`、`cn`、`net`等顶级DNS服务器。

5. 根服务器收到请求后，根据域名的顶级域名返回`com`的 DNS 服务器 IP 地址。其他网站比如`www.taobao.com`是`.com`域下的，返回com DNS服务器IP地址，`www.csdn.net`是`.cn`域下的，返回cn DNS 服务器 IP 地址。

6. 本地DNS服务器接收到`com`顶级域名的DNS服务器IP地址后，向它发送请求。

7. 顶级域名的DNS服务器管理二级域名的DNS服务器。`com`顶级域名的DNS服务器接收到请求后，返回`google.com`域名的 DNS 服务器 IP 地址。

8. 本地DNS服务器收到`google.com`域名的 DNS 服务器 IP 地址，再向它发起请求。

9. 二级DNS服务器，可以通过网站方进行部署，意为这个域名指向的具体IP地址是由我决定的。`google.com`域名的 DNS 服务器接收到请求之后，把 `www.google.com` 所在的服务器 IP 地址返回。

10. 本地DNS服务器接收到之后再返回给主机，一般都会缓存，主机知道了IP地址，就能发送HTTP请求，最终进入网站。

11. 整个过程如下图所示，就好比老师查询地址簿，先判断小明的家在北京市，再判断在北京市下辖的朝阳区，最后再朝阳区的范围中找到小明家的具体位置。

![DNS流程图](https://upload-images.jianshu.io/upload_images/4538003-d46f180b5bca276b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## DNS缓存
**DNS缓存**，为了防止每次域名解析都请求都重新请求一遍，会把域名和IP地址的映射关系保存下来，即为DNS缓存。一般3个地方具有DNS缓存。
1. 除了上面介绍的3类服务器之外，许多大公司、网络运行商都会建立自己的 DNS 服务器，作为客户主机 DNS 查询的代理，代替它访问核心 DNS 系统。本地DNS服务器保存域名查询的结果。
2. 客户主机操作系统把 IP 地址和域名的映射关系保存在内存中。
3. 客户端主机的`host`文件会把所有解析过的域名和ip地址映射关系保存下来。

域名解析会先查询缓存，缓存查询顺序是操作系统 DNS 缓存->host文件->本地 DNS 服务器缓存。
阿里云、腾讯提供的 DNS 解析服务器也是类似这个作用，可以最快帮助用户将域名解析成 IP 地址。

## DNS的优点

1. 如果网站服务器出现故障，需要迁移到另外一台服务器上面，IP 地址改变，只需要在权威服务器改为新的 IP 即可，不用告诉所有人我的 IP 变了。

2. 负载均衡，一个网站有多个服务器，通过DNS一个域名可以指向多个IP地址，DNS服务器每次可能返回的是不同的IP地址，返回离客户最近的服务器 IP 地址，或者使用轮询算法，可能小明访问网站DNS服务器返回的是`192.168.0.1`，小王返回网站DNS服务器返回的是`192.167.0.1`。
   除此之外，DNS 解析还可以返回 CDN 的服务器 IP 地址。


## 安全问题

如果我们DNS被挟持了，你访问的网站被指向了一个钓鱼网站的IP地址。就好比我们以前登录游戏网站，有人做了一个样的钓鱼网站。由于你的DNS被挟持，所以当你输入网址时就跳转到了钓鱼网站上面，然后你输入了账号和密码，这时候你的账号就被盗了。

所以我们不要随便连外面的wifi，也要注意网络安全。

